<extend name="Base/base"/>
<block name="page_content">
    <div class="page-content">

        <!-- BEGIN PAGE CONTAINER-->

        <div class="container-fluid">

            <!-- BEGIN PAGE HEADER-->

            <div class="row-fluid">

                <div class="span12">

                    <!-- BEGIN PAGE TITLE & BREADCRUMB-->

                    <h3 class="page-title">

                        {$pageName} -- {$thisModule[modulename]}

                    </h3>

                    <!-- END PAGE TITLE & BREADCRUMB-->

                </div>

            </div>

            <!-- END PAGE HEADER-->

            <!-- BEGIN PAGE CONTENT-->

            <div class="row-fluid">

                <div class="span12">

                    <table class="table table-striped table-bordered table-hover dataTable" id="sample_1" aria-describedby="sample_2_info">

                        <thead>

                        <tr role="row">

                            <th width="5%" class="sorting_disabled" role="columnheader" rowspan="1" colspan="1" aria-label="">
                                <input type="checkbox" class="group-checkable" data-set="#sample_2 .checkboxes">
                            </th>

                            <th class="sorting_disabled" role="columnheader" rowspan="1" colspan="1" aria-label="" width="20%">标题
                            </th>

                            <th class="sorting_disabled" role="columnheader" rowspan="1" colspan="1" aria-label="" width="15%">添加时间
                            </th>

                            <th class="sorting_disabled" role="columnheader" rowspan="1" colspan="1" aria-label="" width="15%">点击次数
                            </th>

                            <th class="sorting_disabled" role="columnheader" rowspan="1" colspan="1" aria-label="" width="5%">排序
                            </th>

                            <th class="sorting_disabled" role="columnheader" rowspan="1" colspan="1" aria-label="" width="40%">操作
                            </th>
                        </tr>

                        </thead>

                        <tbody role="alert" aria-live="polite" aria-relevant="all">
                        <foreach name="articles" item="article">
                            <tr class="gradeX odd">

                                <td class="sorting_1"><input type="checkbox" class="checkboxes" name="id[]" value="{$article[id]}"></td>

                                <td class=""> {$article[title]}
                                    <!-- TODO  需要显示图片 -->
                                    <if condition="($article[isstickies] lt 10)"> <img src="{$Think.const.ADMIN_IMG_PATH}/ding.gif" alt=""> </if>
                                </td>

                                <td class="">{:date('Y-m-d H-i-s', $article[addtime])}</td>

                                <td class="center">{$article[hit]}</td>

                                <td class="center">{$article[listnum]}</td>

                                <td>
                                    <if condition="($pageName neq '轮播新闻列表')">
                                    <a href="/admin/news/edit?id={$article[id]}" class="btn blue">编辑</a>
                                    <a href="/admin/news/top?id={$article[id]}" class="btn green">置顶</a>
                                    <a href="/admin/news/down?id={$article[id]}" class="btn yellow">取消置顶</a>
                                    <a href="javascript:void(0);" onclick="del_new({$article[id]}, '{$article[title]}', this)" class="btn red">删除</a>
                                    </if>
                                    <if condition="($article[slider] eq 1)">
                                    <a href="javascript:void(0);" onclick="slider({$article[id]}, 'remove', this)" class="btn red">下架轮播</a>
                                        <else/>
                                    <a href="javascript:void(0);" onclick="slider({$article[id]}, 'put', this)" class="btn green">上架轮播</a>
                                    </if>
                                </td>

                            </tr>
                        </foreach>
                        </tbody>

                    </table>
                    <if condition="($pageName neq '轮播新闻列表')">
                    <div class="form-actions">

                        <a href="/admin/news/edit?mid={$thisModule[id]}" class="btn green pull-right">添加信息</a>

                    </div>
                    </if>
                </div>

            </div>

            <!-- END PAGE CONTENT-->

        </div>

        <!-- END PAGE CONTAINER-->

    </div>
</block>
<block name="js_module">
    <script>
        function del_new(id, title, obj) {
            var _flag = confirm("确认要删除新闻\'" + title + "\"?");
            if (_flag) {
                $.get("/admin/news/delete",
                        {id:id},
                function (data) {
                    if (data.status == 1000) {
                        alert("新闻已删除!");
                        $(obj).parents('tr').remove();
                    } else {
                        alert(data.data);
                    }
                }, "json")
            }
        }

        function slider(id ,type, obj) {
            $.get('/admin/news/'+type,
                    {id:id},
            function (data) {
                if(data.status == 1000) {
                    alert(data.data);
                    $(obj).attr('onclick', 'slider('+ id + ', \'remove\', this)');
                    $(obj).removeClass('green').addClass('red').html('下架轮播');
                } else if(data.status == 10000) {
                    alert(data.data);
                    if('{$pageName}' == '轮播新闻列表') {
                        $(obj).parents('tr').remove();
                        return true;
                    }
                    $(obj).attr('onclick', 'slider('+ id + ', \'put\', this)');
                    $(obj).removeClass('red').addClass('green').html('上架轮播');
                } else {
                    alert(data.data);
                }
            }, "json")
        }
    </script>
</block>